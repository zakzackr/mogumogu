# システムの目的・背景
ラーメンブログアプリ。

## 技術スタック
- **フロントエンド**: Next.js, TypeScript, Tailwind CSS, shadcn/ui, Tiptap
- **バックエンド**: Go
- **データベース**: MySQL
- **インフラ**: 検討中（Vercel, AWS）, Docker
- **その他**: Git, Swagger UI

## 全体構成図
- システム全体像（アーキテクチャ概要図）

## 機能要件
1. **認証機能**
    - メールアドレス・パスワードでの新規登録、ログイン
    - ログアウト
2. **記事投稿機能**
    - 記事の作成（Notionライクなテキスト入力。画像投稿も可能。）
    - 記事の投稿
    - 記事の編集
    - 記事の削除
    - 記事の下書き保存
3. **記事表示機能**
    - 記事一覧表示
    - 記事詳細表示
    - いいね機能
    - 記事の保存
4. **ユーザー機能**
    - いいね
    - プロフィール表示
    - プロフィール編集
    - コメント
    - ランキング表示（週間、月間、年間）

## 非機能要件
1. **セキュリティ**
    - ユーザー認証として、JWT認証を採用する。
    - パスワードはハッシュ化して保存する。平文で保存しないこと。
    - CookieのSameSite:Noneで運用する場合は、CSRF対策を必ず行うこと。
    - database/sqlを使用する場合は、SQLインジェクション対策で、ローSQLを避け、プリペアドステートメントを使用すること。必要に応じでORMを導入すること。
2. **ユーザビリティ**
    - レスポンシブデザイン対応
    - シンプルで使いやすいデザイン

## 画面構成
- ホーム画面（記事一覧表示）
- 記事詳細画面（記事の内容表示）
- ログイン・新規登録画面
- プロフィール画面
- ランキング画面（記事のランキングを表示）

## データベース設計
作成中...

## API設計
./openapi.yaml参照

## 認証設計
### JWT認証
- **HttpOnly Cookieに保管** すること。
    - JWTをLocalStorageに保管する場合、クライアントコンポーネントからはJWTにアクセスできるが、サーバーコンポーネントからはJWTにアクセスできない。
    - CookieにJWTを保管することで、サーバーコンポーネントからも、クライアントコンポーネントからもアクセス可能になる。

#### Cookieの設定
- HttpOnly属性: true
- Secure属性: false（開発時）、true（本番環境）
- SameSite属性: none
- Max-Age属性: 2時間（JWTの有効期限と同じにする）

#### JWTの設定
- subクレーム: username
- expクレーム: 2時間（有効期限）
- roleクレーム: 権限（例: ROLE_ADMIN, ROLE_USER）


## 認可設計

以下の2つの権限を作成する。

### ROLE_ADMIN

- ROLE_USERが実行可能な全ての操作

### ROLE_USER

- 記事の一覧表示、詳細表示、投稿、編集、削除
- トークテーマの表示
- いいね、MVP機能
- プロフィール機能、コメント機能
- などトークテーマ作成以外の全ての操作
  
ログイン済みのユーザーとログイン済みでないユーザーで動作を分ける。（例：ログインユーザーのみ投稿可能。いいね、保存可能など）そのための権限を考えること。



